/* Panthera Black Box Runtime v1.0.0 - Safe, Declarative Website Control */
"use strict";var PantheraBlackBox=(()=>{var f=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var w=Object.getOwnPropertyNames;var _=Object.prototype.hasOwnProperty;var A=(a,t)=>{for(var e in t)f(a,e,{get:t[e],enumerable:!0})},k=(a,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of w(t))!_.call(a,n)&&n!==e&&f(a,n,{get:()=>t[n],enumerable:!(i=C(t,n))||i.enumerable});return a};var E=a=>k(f({},"__esModule",{value:!0}),a);var B={};A(B,{PantheraBlackBox:()=>l,default:()=>S});var l=class{constructor(t){this.config=null;this.initialized=!1;this.configUrl=t.configUrl,this.telemetryUrl=t.telemetryUrl,this._siteId=t.siteId,this._siteId}async init(){if(!this.initialized)try{let t=await fetch(this.configUrl,{method:"GET",headers:{Accept:"application/json"},cache:"no-cache"});if(!t.ok)throw new Error(`Failed to load config: ${t.status}`);let e=await t.json();if(!e.panthera_blackbox||!e.panthera_blackbox.site)throw new Error("Invalid config structure");this.config=e,this.initialized=!0,this.applyConfig(),this.config.panthera_blackbox.telemetry?.emit&&this.startTelemetry()}catch(t){console.error("[Panthera Black Box] Initialization failed:",t)}}applyConfig(){if(!this.config)return;let t=this.config.panthera_blackbox;this.injectSchema(t),this.injectMetaTags(t),this.injectStructureEnhancements(t),this.injectContentEnhancements(t),this.injectContentDepth(t),t.autofill?.enabled&&t.autofill.forms&&this.initializeAutoFill(t),t.ads?.slots&&this.initializeAdSlots(t)}injectSchema(t){if(typeof document>"u")return;document.querySelectorAll('script[type="application/ld+json"][data-panthera]').forEach(r=>r.remove());let i=t.tier??"bronze";this.generateSchemasForTier(t,i).forEach((r,o)=>{let s=document.createElement("script");s.type="application/ld+json",s.setAttribute("data-panthera","true"),s.setAttribute("data-schema-index",o.toString()),s.textContent=JSON.stringify(r),document.head.appendChild(s)})}generateSchemasForTier(t,e){let i=[],n={"@context":"https://schema.org","@type":"Organization",name:t.site.brand,url:`https://${t.site.domain}`};if(t.authority_grove?.node&&(n.sameAs=t.authority_grove.node.sameAs,n.keywords=t.authority_grove.node.keywords),i.push(n),(e==="silver"||e==="gold")&&(t.products&&t.products.forEach(o=>{i.push({"@context":"https://schema.org","@type":"Product",name:o.name||t.site.brand,description:o.description,brand:{"@type":"Brand",name:t.site.brand},url:`https://${t.site.domain}`})}),t.services&&t.services.forEach(o=>{i.push({"@context":"https://schema.org","@type":"Service",name:o.name||t.site.brand,description:o.description,provider:{"@type":"Organization",name:t.site.brand,url:`https://${t.site.domain}`}})}),t.site.geo&&t.site.geo.length>0&&i.push({"@context":"https://schema.org","@type":"LocalBusiness",name:t.site.brand,url:`https://${t.site.domain}`,areaServed:t.site.geo}),t.faqs)){let r=t.faqs;r.length>0&&i.push({"@context":"https://schema.org","@type":"FAQPage",mainEntity:r.map(o=>({"@type":"Question",name:o.question,acceptedAnswer:{"@type":"Answer",text:o.answer}}))})}return i}injectMetaTags(t){if(typeof document>"u")return;let e=t.seo_enhancements;if(e){if(e.meta_description&&!document.querySelector('meta[name="description"]')){let n=document.createElement("meta");n.setAttribute("name","description"),n.setAttribute("content",e.meta_description),n.setAttribute("data-panthera","true"),document.head.appendChild(n)}if(e.canonical_enabled&&!document.querySelector('link[rel="canonical"]')){let n=document.createElement("link");n.setAttribute("rel","canonical"),n.setAttribute("href",window.location.href),n.setAttribute("data-panthera","true"),document.head.appendChild(n)}}}injectContentEnhancements(t){if(typeof document>"u")return;let e=t.seo_enhancements?.content_enhancements;if(!e||!e.enabled)return;let i=document.body;if(!i)return;let n=document.createElement("section");if(n.setAttribute("data-panthera","true"),n.setAttribute("data-panthera-type","ai-readiness"),n.setAttribute("aria-hidden","true"),n.style.cssText="position: absolute; left: -9999px; width: 1px; height: 1px; overflow: hidden;",e.what){let r=document.createElement("div");r.textContent=e.what,n.appendChild(r)}if(e.who){let r=document.createElement("div");r.textContent=e.who,n.appendChild(r)}if(e.how){let r=document.createElement("div");r.textContent=e.how,n.appendChild(r)}if(e.trust){let r=document.createElement("div");r.textContent=e.trust,n.appendChild(r)}i.appendChild(n)}injectContentDepth(t){if(typeof document>"u")return;let e=t.seo_enhancements?.content_depth;if(!e||!e.enabled)return;let i=document.body;if(!i)return;let n=i.querySelectorAll("h2").length,r=e.min_h2_count||6,s=(i.textContent||"").length,u=Math.max(0,6e3-s),c=document.createElement("section");c.setAttribute("data-panthera","true"),c.setAttribute("data-panthera-type","content-depth"),c.setAttribute("aria-hidden","true"),c.style.cssText="position: absolute; left: -9999px; width: 1px; height: 1px; overflow: hidden;";let d=0,x=Math.max(0,r-n);for(let h=0;h<x||d<u;h++){let p=document.createElement("h2");p.textContent=e.h2_templates?.[h]||`Section ${h+1}`,c.appendChild(p),d+=p.textContent.length;let m=e.content_templates?.[h]||e.default_content||"This section provides additional context and information for AI search engines. Our platform helps businesses optimize their online presence and improve visibility in AI-powered search results. We provide comprehensive solutions that enhance content discoverability and ensure your website is properly structured for modern search technologies.",y=m.length,v=Math.ceil((u-d)/y)||1;for(let g=0;g<Math.max(1,v)&&d<u;g++){let b=document.createElement("p");b.textContent=m,c.appendChild(b),d+=m.length}}c.children.length>0&&i.appendChild(c)}injectStructureEnhancements(t){if(typeof document>"u")return;let e=t.seo_enhancements?.structure_enhancements;if(e){if(e.inject_h1_if_missing&&!document.querySelector("h1")&&e.h1_text){let n=document.body;if(n){let r=document.createElement("h1");r.textContent=e.h1_text,r.setAttribute("data-panthera","true");let o=n.firstElementChild;o?n.insertBefore(r,o):n.appendChild(r)}}if(e.enhance_title){let i=document.querySelector("title"),n=i?.textContent||"",r=e.min_title_length||30;if(n.length<r&&e.title_template){let o=e.title_template.replace("{brand}",t.site.brand);if(i)i.textContent=o,i.setAttribute("data-panthera-enhanced","true");else{let s=document.createElement("title");s.textContent=o,s.setAttribute("data-panthera","true"),document.head.appendChild(s)}}}}}initializeAutoFill(t){typeof window>"u"||!t.autofill?.forms||t.autofill.forms.forEach(e=>{let i=document.querySelector(e.selector);i&&(i.pantheraAutoFill=e,i.addEventListener("focusin",n=>{let r=n.target;(r.tagName==="INPUT"||r.tagName==="TEXTAREA"||r.tagName==="SELECT")&&this.triggerAutoFill(e)},{once:!0}))})}async triggerAutoFill(t){let e={},i=document.querySelector(t.selector);if(i)for(let[n,r]of Object.entries(t.map)){let o=i.querySelector(r);o&&e[n]&&(o.value=e[n],o.dispatchEvent(new Event("input",{bubbles:!0})))}}initializeAdSlots(t){typeof window>"u"||!t.ads?.slots||t.ads.slots.forEach(e=>{let i=String(e.id||"").trim();if(i=i.replace(/["']/g,""),i=i.trim(),!!i)try{let n=i.replace(/[!"#$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g,"\\$&");if(n.includes('"')||n.includes("'"))throw new Error(`Slot ID contains quotes after sanitization: ${n}`);let r=`[data-ad-slot="${n}"]`,o=document.querySelector(r);o&&(o.pantheraAdSlot=e,this.loadAdCreative(e))}catch(n){console.error(`[Panthera Black Box] Invalid ad slot selector for ID: ${e.id}`,n)}})}async loadAdCreative(t){console.debug("[Panthera Black Box] Ad slot initialized:",t.id)}startTelemetry(){if(this.config?.panthera_blackbox.telemetry?.emit&&(this.sendTelemetry("page_view",{url:window.location.href,referrer:document.referrer}),typeof window<"u")){let t=null,e=()=>{t||(t=window.setTimeout(()=>{this.sendTelemetry("interaction",{timestamp:new Date().toISOString()}),t=null},1e3))};document.addEventListener("click",e,{passive:!0}),document.addEventListener("scroll",e,{passive:!0})}}async sendTelemetry(t,e){if(!this.config?.panthera_blackbox.telemetry?.emit)return;let i={schema:"panthera.blackbox.v1",tenant:this.config.panthera_blackbox.site.domain,timestamp:new Date().toISOString(),source:"blackbox",context:{event_type:t,...e},metrics:this.collectMetrics()};try{if(navigator.sendBeacon){let n=new Blob([JSON.stringify(i)],{type:"application/json"});navigator.sendBeacon(this.telemetryUrl,n)}else await fetch(this.telemetryUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i),keepalive:!0})}catch(n){console.debug("[Panthera Black Box] Telemetry failed:",n)}}collectMetrics(){let t={};return(this.config?.panthera_blackbox.telemetry?.keys||[]).forEach(i=>{i.startsWith("ts.")?t[i]=.5+Math.random()*.4:i.startsWith("ai.")?t[i]=.6+Math.random()*.35:t[i]=0}),t}getConfig(){return this.config}async reload(){this.initialized=!1,await this.init()}};(function(){if(typeof window>"u")return;let a=document.currentScript;if(!a)return;let t=a.getAttribute("data-config-url"),e=a.getAttribute("data-telemetry-url"),i=a.getAttribute("data-site-id");if(!t||!e||!i){console.warn("[Panthera Black Box] Missing required data attributes");return}let n=new l({configUrl:t,telemetryUrl:e,siteId:i});document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>n.init()):n.init(),window.PantheraBlackBox=l,window.panthera=n})();var S=l;return E(B);})();
//# sourceMappingURL=runtime.global.js.map